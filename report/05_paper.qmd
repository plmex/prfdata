---
title: "Modelo Preditivo de Mortes Anuais no Trânsito no Brasil"
date: 2023-09-28

smooth-scroll: true

authors:
  - name: João Pedro Melani Saraiva
  - name: Pedro Augusto Borges dos Santos

description: Modelo baseado em regressão linear multivariada para a previsão de mortes no trânsito

title-block-banner: true

format: 
  html:
    theme: style.scss
    editor: visual
    dpi: 300

knitr: 
  opts_chunk: 
    fig.align: center

bibliography: references.bib
toc: true
toc-title: Sumário

lang: pt
---

```{r include=FALSE}
# packages
library(tidyverse)
library(ggcorrplot)
library(onsvplot)
library(knitr)
library(here)
library(tidymodels)
library(kableExtra)

# opções de display
options(digits = 2)

# load dos dados
load(here("data","tabela_total.rda"))

# supressão dos warnings
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

## Introdução

O presente cenário mundial acerca de mortes e lesões relacionadas à sinistros de trânsito posam sérios desafios à saúde pública global, e as tendências evidenciadas pelos dados atuais indicam que esta realidade deve continuar a se manter pelo futuro próximo [@worldhealthorganization2018]. Sendo uma das causas de mortes mais comuns no mundo, as ocorrências de sinistros de trânsito afetam principalmente pedestres, ciclistas e motociclistas, além de induzir danos materiais, tanto em questão de propriedade particular quanto pública. Isto estimula países a buscarem métodos estimativos sobre os efeitos sociais, econômicos e epidemiológicos da taxa de mortes no trânsito e como se traduzem em custos e perdas na produtividade da sociedade em geral [@rodríguez2020].

A segurança viária pode se correlacionar ao estado de desenvolvimento de uma região, visto que é uma característica da mobilidade urbana. Entende-se que as mortes no trânsito dependem de diversos fatores estruturais, socioeconômicos e ambientais [@zhong-xiang2014]. Assim, elevadas taxas de sinistros colaboram no diagnóstico de problemas da segurança pública geral, despertando o debate político sobre a regulamentação das normas viárias e apontando a carência dos sistemas da união em combater estes eventos.

Apesar da crescente adesão por itens de segurança veicular, os sinistros de trânsito permanecem como um problema de saúde pública, visto que fazem parte de um agravo que repercute por toda a sociedade [@andrade2019], sendo a oitava causa de óbitos em todas as faixas etárias e a principal entre indivíduos de 5 a 29 anos [@worldhealthorganization2018]. Como previsto por modelos prévios à 2020 [@blumenberg2018], o Brasil apresentou baixo desempenho em cumprir a meta estabelecida pela Primeira Década de Ações pela Segurança no Trânsito. Neste cenário, o Plano Nacional de Redução de Mortes e Lesões no Trânsito (PNATRANS) foi desenvolvido para guiar as ações pela mobilidade segura nacional durante o período da Segunda Década de Ação pela Segurança no Trânsito [@ministériodostransporte2018], na intenção de aprimorar o desempenho da segurança viária em relação a década passada e se alinhando aos Objetivos de Desenvolvimento Sustentável estabelecidos pela Agenda 2030 da Organização das Nações Unidas (ONU). Para atingir tais metas, o Art. 3º da Resolução Contran Nº 870 relata que o PNATRANS se apoia em seis principais pilares: gestão da segurança no trânsito, vias seguras, segurança veicular, educação para o trânsito, atendimento às vítimas, e normalização e fiscalização [@conselhonacionaldetrânsito2018].

A busca pela fundamentação técnica para a proposição de políticas públicas a respeito da mobilidade segura fomenta o estudo de diversas categorias de modelos preditivos para a mortalidade no trânsito, tanto para estimar o número de ocorrências quanto para avaliar a influência das variáveis consideradas. Modelos lineares multivariados foram ajustados para extrair tendências sobre os critérios aferidos [@blumenberg2018; @cai2015], assim como modelos preditivos baseados em cadeia de Markov [@seneta1996; @jin2020]. Outras abordagens utilizaram técnicas de análise de séries temporais, utilizando métodos como o ARIMA - Modelo Auto-Regressivo Integrado de Médias Móveis [@al-ghamdi1995] e redes neurais artificiais [@jafari2015].

Considerando o presente cenário, este estudo tem como objetivo elaborar um modelo linear de melhor ajuste para a previsão de mortes no trânsito em âmbito nacional no Brasil, investigando dados socioeconômicos, como o Produto Interno Bruto (PIB) e a população, fornecidos respectivamente pelo Instituto Brasileiro de Geografia e Estatística (IBGE) [@institutobrasileirodegeografiaeestatística2023] e pelo Ministério da Saúde [@ministériodasaúde2023b], assim como dados coletados das bases de dados da Polícia Federal Rodoviária (PRF) [@políciarodoviáriafederal2023], do Registro Nacional de Condutores Habilitados (RENACH) [@ministériodostransporte2023], do Registro Nacional de Veículos Automotores (RENAVAM) [@ministériodostransportes2023] e do Sistema de Informação de Mortalidade (SIM) do Ministério da Saúde [@ministériodasaúde2023a].

## Metodologia

A obtenção dos dados de mortalidade foram efetuados através do pacote `microdatasus` [@microdatasus], elaborado para a linguagem R. Coletou-se dados oriundos do período entre 1996 e 2021. Esta escolha de intervalo temporal visa englobar a mortalidade estimada sob o protocolo da CID-10, pelo qual o banco de dados foi adequado ao estudo extraindo apenas as observações de mortes relacionadas a sinistros, ou seja, aquelas que se encaixam entre os códigos "V01" à "V89".

As demais variáveis foram tratadas e imputadas em uma única tabela:

-   Frota de veículos (RENAVAM);
-   Frota de motocicletas (RENAVAM);
-   Frota de automóveis (RENAVAM);
-   PIB (IBGE);
-   População (DATASUS);
-   Quantidade de sinistros em rodovias federais (PRF);
-   Quantidade de sinistros fatais em rodovias federais (PRF);
-   Feridos em sinistros ocorridos em rodovias federais (PRF);
-   Mortos em sinistros ocorridos em rodovias federais (PRF);
-   Quantidade de condutores habilitados (RENACH).

Em razão da ausência de dados prévios à 2011 de certas fontes, o intervalo de estudo foi reduzido para 2011 a 2021.

Assim sendo, a análise exploratória dos dados (AED) foi produzida para efetivar a validade dos dados e a significância delas para a construção do modelo. É observável que diversas variáveis possuem alto grau de colinearidade entre si, indicando que a modelagem utilizando todos os atributos poderia ser afetada por uma multicolinearidade, assim, podendo resultar em um modelo com baixa performance. A correlação de Spearman foi utilizada e seus resultados estão apresentados à seguir na @fig-corr

```{r}
#| echo: false
#| label: fig-corr
#| fig.cap: Correlograma dos atributos
#| fig.width: 8
#| fig.height: 6
#| fig.dpi: 300

cor_spearman <- df_total |> 
  drop_na() |>
  select(-quilometragem_10_bilhoes) |> 
  cor(method = c("spearman"))

ggcorrplot(
  cor_spearman,
  lab_col = "white",
  type = "lower",
  lab = TRUE, 
  hc.order = T,
  lab_size = 3, 
  tl.srt = 60,
  tl.cex = 12, 
  legend.title = "Correlação",
  colors = c(onsv_palette$blue, "white", onsv_palette$red)
)

```

As variáveis foram avaliadas em relação a sua frequência e densidade. Considerou-se que, em geral, elas possuem comportamentos que devaneiam da normalidade em questão de suas distribuições de probabilidade. Por este motivo, o método mais adequado utilizado para o cálculo dos coeficientes de correlação foi o de Spearman, visto que é uma medida não-paramétrica. Em seguida, cada variável foi testada com um modelo linear, considerando a quantidade de mortes como variável dependente para encontrar seus $p$-valores e métricas de erro quando investigadas individualmente.

Desta forma, a próxima etapa inclui a engenharia dos atributos para a otimização do modelo. O estudo inferencial mostra como diversas variáveis consideradas possuem alta colinearidade, congruente com as relações reais que uma categoria de dado têm com a ocorrência de outro. Por exemplo, a quantidade de mortes em sinistros de trânsito é diretamente correlacionada com a quantidade de sinistros fatais, que por sua vez é correlacionada com a quantidade de sinistros totais. As três variáveis, em adição à quantidade de feridos, estão apresentadas na série temporal da @fig-prf à seguir.

```{r}
#| echo: false
#| label: fig-prf
#| fig.cap: Sinistros e óbitos ocorridos em rodovias federais
#| fig.width: 7
#| fig.height: 5

theme_set(theme_onsv())

df_total %>% 
  select(ano, qnt_acidentes_fatais, qnt_acidentes, qnt_feridos, qnt_mortos) %>%
  pivot_longer(-1, names_to = "variavel", values_to = "n") %>% 
  ggplot(aes(x = ano, y = n, color = variavel)) +
  geom_point(shape = 21, size = 1.5, stroke = 1.5) +
  geom_line(linewidth = 1, alpha = 0.25) +
  labs(x = NULL, y = NULL) +
  scale_x_continuous(limits = c(2007, 2021), breaks = seq(2006, 2021, 1)) +
  scale_y_continuous(labels = comma_format(big.mark = ".")) +
  scale_color_manual(
    labels = c("Sinistros", "Sinistros fatais", "Feridos", "Mortes"),
    values = c(
      onsv_palette$red, 
      onsv_palette$yellow, 
      onsv_palette$blue, 
      onsv_palette$green
    )
  )
```

Outra variável que deve ser analisada individualmente é o número de condutores, que possui uma alta correlação com a população e um comportamento similar em questão da sua contribuição ao modelo. Para verificar se o número de condutores possui um acréscimo homogêneo ao longo do período estudado, calcula-se a quantidade de novos condutores por ano, como visto na @fig-novos-cond, denotando como o ano de 2020 sofreu uma brusca queda de novos indivíduos, possivelmente devido aos impactos da pandemia. Em relação à variável população, os condutores oferecem melhores valores nas métricas de funcionamento.

```{r}
#| echo: false
#| label: fig-novos-cond
#| fig.cap: Número de novos condutores a por ano
#| fig.width: 7
#| fig.height: 5

novos_condtrs <- df_total |>
  mutate(novos_condutores = condutores - lag(condutores)) |> 
  select(novos_condutores, condutores, everything())

novos_condtrs |> 
  ggplot(aes(x = ano, y = novos_condutores)) +
    geom_point(shape = 21, size = 1.5, stroke = 1.5, color = onsv_palette$blue) +
    geom_line(linewidth = 1, alpha = 0.25, color = onsv_palette$blue) +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
    scale_x_continuous(breaks = seq(1996, 2022, 1), limits = c(2012,2022)) +
    scale_y_continuous(labels = comma_format(big.mark = ".")) +
    labs(x = NULL, y = NULL)
```

Os atributos altamente colineares de menos influência nas predições são deletados do conjunto de dados a fim de preservar a capacidade de generalização do modelo, mitigando os efeitos de um possível sobreajuste. A quantidade de mortos em rodovias federais foi considerada uma variável redundante, sendo removida, assim como o PIB, a população e a quantidade de feridos, que foram consideradas menos atuantes na precisão dos resultados. 

Após a seleção das variáveis de melhor desempenho, a base de dados foi padronizada a fim de otimizar sua performance e estabilidade no momento de ajuste do modelo de regressão linear. Os coeficientes da regressão linear multivariada estão apresentados à seguir:

```{r}
#| include: false

metricas <- metric_set(rmse, mae, rsq)

df_preprocess <- df_total |> 
  select(
    ano,
    mortes,
    veiculos_total,
    qnt_acidentes_fatais,
    condutores,
    qnt_acidentes
  ) |> 
  drop_na()

lm_recipe <- df_preprocess |> 
  recipe(
    mortes ~
      veiculos_total +
      qnt_acidentes_fatais +
      condutores +
      qnt_acidentes
  ) |>
  step_normalize(all_numeric_predictors())

lm_reg <- linear_reg() |> 
  set_engine("lm")

lm_wflow <- workflow() |> 
  add_recipe(lm_recipe) |> 
  add_model(lm_reg) |> 
  fit(df_preprocess)

coefs <- tidy(lm_wflow) |>
  arrange(p.value)

obs2022 <- list(
  "ano" = 2022,
  "qnt_acidentes" = 64547,
  "qnt_acidentes_fatais" = 4662,
  # "qnt_mortos" = 5439,
  # "qnt_feridos" = 72971,
  "condutores" = 79921178,
  "veiculos_total" = 115116532
  # "pib" = 9915317
) |> 
  as.data.frame()

df_preprocess_2022 <- bind_rows(df_preprocess, obs2022)

df_pred <- lm_wflow |> 
  predict(df_preprocess_2022) |> 
  cbind(df_preprocess_2022)

df_pred <- lm_wflow |> 
  predict(df_preprocess_2022, type = "conf_int") |> 
  cbind(df_pred) |> 
  mutate(.variation = .pred_upper - .pred_lower)

erros <- metricas(data = df_pred, truth = mortes, estimate = .pred)
```

```{r}
#| echo: false
#| label: tab-coef
#| tbl-cap: Coeficientes resultantes

coefs |>
  rename(Variável = term, Coeficiente = estimate, 'P-valor' = p.value) |> 
  select(-std.error, -statistic)|> 
  mutate(
    Variável = case_match(
      Variável,
      "(Intercept)" ~ "Intercepto",
      "qnt_acidentes_fatais" ~ "Sinistros fatais em rodovias federais",
      "veiculos_total" ~ "Frota de veiculos",
      "condutores" ~ "Condutores habilitados",
      "qnt_acidentes" ~ "Sinistros em rodovias federais"
    )
  ) |> 
  mutate(Coeficiente = format(Coeficiente, big.mark = ".", decimal.mark = ","),
         `P-valor` = format(round(`P-valor`, 2), decimal.mark = ",")) |> 
  kable(align = c("l","r","r"), table.attr = "quarto-disable-processing=true") |> 
  kable_styling(full_width = F)
```

## Resultados e Discussão

Devido ao fato de que a quantidade de dados é reduzida, é inviável a aplicação de técnicas de avaliação de modelo como a separação de conjuntos para treino e teste ou a validação cruzada (*Cross validation*). Por outro lado, a capacidade do algoritmo regressivo pode ser mensurada pelo comparação entre os dados de mortes iniciais com o produto encontrado pelo modelo, conforme apresentado na @fig-reg.

```{r}
#| echo: false
#| label: fig-reg
#| fig.cap: Quantidade de mortes em sinistros de trânsito
#| fig.width: 7
#| fig.height: 4

modelo_linear <- 
  linear_reg() |> 
  set_engine("lm")

mortes_wflow <- 
  workflow() |> 
  add_recipe(lm_recipe) |> 
  add_model(modelo_linear)

mortes_wflow_ajustado <- mortes_wflow |>
 fit(df_total)
  
mortes_previsao <- mortes_wflow_ajustado |>
  predict(df_total) |>
  rename(mortes_pred = .pred)

mortes_previsao <- cbind(df_total, mortes_previsao)

mortes_previsao |> 
  select(mortes, mortes_pred, ano) |> 
  rename(Ano = ano, Previsto = mortes_pred, Real = mortes) |> 
  pivot_longer(cols = c(Previsto, Real), names_to = "Tipo", values_to = "Mortes") |> 
  ggplot(aes(x = Ano, y = Mortes, color = Tipo)) +
    geom_point(shape = 21, size = 1.5, stroke = 1.5) +
    geom_line(linewidth = 1, alpha = 0.25) +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
    scale_x_continuous(breaks = seq(1996, 2021, 1)) +
    scale_y_continuous(labels = comma_format(big.mark = ".")) +
    labs(x = NULL, y = NULL) +
    scale_discrete_onsv()
```

O modelo foi utilizado para prever a ocorrência de mortes relacionadas à sinistros de trânsito em 2022, recebendo como *input* os respectivos dados das bases anteriormente consultadas. A predição aponta a tendência anual das mortes, com limites de erro considerados em um intervalo de confiança, conforme apresentado na @fig-pred. O valor previsto para 2022, com base no modelo efetuado, resultou em 33.725 mortes, com um intervalo de confiança entre 31.286 e 36.164 mortes.

```{r}
#| fig.cap: Previsões com intervalo de confiança até 2022
#| echo: false
#| label: fig-pred
#| fig.width: 7
#| fig.height: 5

df_pred |> 
  select(ano, .pred_lower, .pred_upper, .pred, mortes) |> 
  rename(Ano = ano, Previsto = .pred, Real = mortes) |> 
  pivot_longer(
    cols = c(Previsto, Real),
    names_to = "Tipo", 
    values_to = "Mortes"
  ) |> 
  ggplot(aes(x = Ano, y = Mortes)) +
    geom_point(shape = 21, size = 1.5, stroke = 1.5, aes(color = Tipo)) +
    geom_line(linewidth = 1, alpha = 0.25, aes(color = Tipo)) +
    geom_ribbon(
      aes(ymin = .pred_lower, ymax = .pred_upper), 
      fill = "grey",
      alpha = 0.25,
      color = "grey"
    ) +
    scale_x_continuous(breaks = seq(1996, 2022, 1)) +
    scale_y_continuous(labels = comma_format(big.mark = ".")) +
    labs(x = NULL, y = NULL) +
    scale_discrete_onsv()
```

Os métodos selecionados para medir o desempenho do modelo foram a Raiz Quadrada do Erro Médio (*Root Mean Squared Error* - RMSE), o Erro Médio Absoluto (*Mean Squared Error* - MAE) e o R-quadrado - $R^2$. Investigando as métricas de erros com base na comparação do conjunto de dados gerado ao inicial, têm-se:

```{r}
#| echo: false

erros |> 
  select(-.estimator) |> 
  mutate(
    .metric = case_match(
      .metric,
      "rmse" ~ "RMSE",
      "mae" ~ "MAE",
      "rsq" ~ "R²"
    )
  ) |> 
  rename(Métrica = .metric, Valor = .estimate) |> 
  mutate(Valor = format(Valor, decimal.mark = ",")) |> 
  kable(caption = "Métricas de Erros", align = c("l","r"), 
        table.attr = "quarto-disable-processing=true") |> 
  kable_styling(full_width = F) |> 
  column_spec(1, width = "6cm", bold = T)
```

A @fig-qq a seguir apresenta uma comparação entre os dados de mortes previstos e reais.

```{r}
#| echo: false
#| label: fig-qq
#| fig.cap: Comparação mortes previstas x reais
#| fig.width: 7
#| fig.height: 5


df_pred |> 
  select(.pred, mortes, ano) |> 
  rename(Previsto = .pred, Real = mortes) |> 
  ggplot(aes(x = Real, y = Previsto)) +
  geom_point(shape = 21, size = 1.5, stroke = 1.5, color = onsv_palette$blue) +
  geom_text(aes(label = ano), vjust = 2, size = 3) + 
  geom_abline(
    linewidth = 1, 
    alpha = 0.5, 
    color = onsv_palette$blue, 
    lty = "dashed"
  ) +
  scale_y_continuous(labels = comma_format(big.mark = ".")) + 
  scale_x_continuous(labels = comma_format(big.mark = ".")) +
  coord_obs_pred()
```

O valor obtido da previsão implica em uma leve queda de 7,4% no número de mortes em relação ao ano anterior (2021), que registrou 33.813 casos. Conforme a análise dos dados, 2021 foi o segundo ano consecutivo a dispor de um aumento em fatalidades no trânsito. O intervalo de confiança mostra como este pode ser o caso de 2022 novamente, não obstante da diminuição prevista para as mortes. Ademais, é notável que apesar da intensidade das correlações dos preditores selecionados para o estudo, a resolução temporal anual permanece como um gargalo para a análise dos sinistros de trânsito, já que a disponibilidade de dados é reduzida.

## Conclusão

O modelo de regressão desenvolvido permite inferir que há uma tendência perceptível nas mortes causadas pelo trânsito. Mesmo que as previsões demonstrem que há a possibilidade de redução no ano subsequente, é visível que a predição do modelo linear ajustado está substancialmente distante do número de casos de 2019, este sendo o ano com a maior redução nas mortes desde o pico em 2012. Isto revela um potencial relaxamento no desempenho da segurança viária e mobilidadea segura à nível nacional, desencadeiando em uma redução em sua eficiência e causando um aumento na mortalidade em sinistros de trânsito.

É fundamental destacar que a abordagem de problemas de segurança viária não depende apenas de variáveis de mobilidade urbana. Existem diversos fatores de infraestrutura e socioeconômicos que afetam a saúde deste sistema, podendo variar com o estado de desenvolvimento e maturidade tecnológica do país em questão. A mobilidade urbana é uma parte integral à toda civilização moderna, o que torna as ações para a segurança viária indispensáveis.

O cenário atual da segurança viária brasileira anuncia alguns desafios e deficiências que podem impactar na conquista das metas de redução estabelecidas em âmbito nacional pelo PNATRANS. Os dados previstos anunciam uma performance abaixo do ideal no combate da mortalidade, conferindo uma perspectiva pessimista para o início da nova década no Brasil e, caso este cenário não seja amenizado com antecedência, é improvável haverem avanços significativos nos objetivos da Segunda Década de Ação pela Segurança no Trânsito.

## Referências
