---
title: "Análise Exploratória de Dados"
author: "João Saraiva"
format: html
---

## Importando bibliotecas

```{r}
library(tidyverse)
library(ggplot2)
library(knitr)
library(obsplot)
```

## Carregando dados

```{r}
enderecos_data <- paste(
 "data/",
 list.files("data/"),
 sep = ""
)

for (k in enderecos_data) {
  load(k)
}
```

## Preparando labels para junção dos dataframes

```{r}
 frota_veiculos <- frota_veiculos |> 
    rename(
      veiculos_total = total,
      ano = anos
    )

  pib <- pib |> 
    rename(
      pib = total
    )
```

## Juntando os dataframes

```{r}
df_list <- list(
  frota_veiculos,
  obitos_transito,
  pib,
  populacao,
  sinistros_prf,
  tabela_condutores
)

df_total <- df_list |> 
  reduce(full_join, by = "ano") |> 
  relocate(ano) |> 
  arrange(ano)
```

## Iniciando EDA

- Veículos

```{r}
veiculos_plot <- df_total |> 
  select(ano, automovel, motocicleta, veiculos_total) |> 
  pivot_longer(-1) |>
  drop_na() |> 
  ggplot(aes(ano, value, color = name)) +
    geom_point() +
    geom_line() +
    xlab("Anos") +
    ylab("Quantidade") +
    scale_y_continuous(limits = c(0,NA)) +
    scale_x_continuous(breaks = seq(2000,2021,1)) +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

veiculos_plot + scale_discrete_obs()
```

```{r}
mortes_plot <- ggplot(df_total, aes(x = ano, y = mortes)) +
  geom_line() +
  geom_point() +
  expand_limits(y = 0) +
  scale_discrete_obs() +
  scale_y_continuous(limits = c(0,NA)) +
  scale_x_continuous(breaks = seq(1995,2021,1)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

mortes_plot
```

```{r}
prf_plot1 <- df_total |> 
  select(ano, qnt_acidentes_fatais, qnt_mortos, qnt_acidentes, qnt_feridos) |> 
  pivot_longer(-1) |>
  drop_na() |> 
  ggplot(aes(x = ano, y = value, color = name)) +
    geom_line() +
    geom_point() +
    scale_discrete_obs() +
    scale_y_continuous(limits = c(0,NA)) +
    scale_x_continuous(breaks = seq(2006,2021,1)) +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

prf_plot2 <- df_total |> 
  select(ano, qnt_acidentes_fatais, qnt_mortos) |> 
  pivot_longer(-1) |>
  drop_na() |> 
  ggplot(aes(x = ano, y = value, color = name)) +
    geom_line() +
    geom_point() +
    scale_discrete_obs() +
    scale_y_continuous(limits = c(0,NA)) +
    scale_x_continuous(breaks = seq(2006,2021,1)) +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

prf_plot1
prf_plot2
```

```{r}

```

