#
#   if(exists("datatran_anos" == FALSE)){
#     datatran_anos <- tratado_temp
#   }
#   else{
#     datatran_anos <- rbind(datatran_anos,tratado_temp)
#   }
# }
#
# datatran_anos
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[3], locale = locale(encoding = "latin1")) |> datatran_extract()
df_temp1
# rm("datatran_anos")
#
# for(i in enderecos){
#   df_temp <- read.csv2(enderecos[i], locale = locale(encoding = "latin1"))
#   tratado_temp <- df_temp |> datatran_extract()
#
#   if(exists("datatran_anos" == FALSE)){
#     datatran_anos <- tratado_temp
#   }
#   else{
#     datatran_anos <- rbind(datatran_anos,tratado_temp)
#   }
# }
#
# datatran_anos
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[4], locale = locale(encoding = "latin1")) |> datatran_extract()
df_temp1
# rm("datatran_anos")
#
# for(i in enderecos){
#   df_temp <- read.csv2(enderecos[i], locale = locale(encoding = "latin1"))
#   tratado_temp <- df_temp |> datatran_extract()
#
#   if(exists("datatran_anos" == FALSE)){
#     datatran_anos <- tratado_temp
#   }
#   else{
#     datatran_anos <- rbind(datatran_anos,tratado_temp)
#   }
# }
#
# datatran_anos
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[5], locale = locale(encoding = "latin1")) |> datatran_extract()
df_temp1
# rm("datatran_anos")
#
# for(i in enderecos){
#   df_temp <- read.csv2(enderecos[i], locale = locale(encoding = "latin1"))
#   tratado_temp <- df_temp |> datatran_extract()
#
#   if(exists("datatran_anos" == FALSE)){
#     datatran_anos <- tratado_temp
#   }
#   else{
#     datatran_anos <- rbind(datatran_anos,tratado_temp)
#   }
# }
#
# datatran_anos
rm("df_temp","df_temp1","df_temp2")
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
# df_temp1 <- read_csv2(enderecos[5], locale = locale(encoding = "latin1")) |> datatran_extract()
# df_temp1
if("datatran_anos" |> exists()){
rm("datatran_anos")
}
for(i in enderecos){
df_temp <- read.csv2(enderecos[i], locale = locale(encoding = "latin1"))
tratado_temp <- df_temp |> datatran_extract()
print(tratado_temp)
# if(exists("datatran_anos" == FALSE)){
#   datatran_anos <- tratado_temp
# }
# else{
#   datatran_anos <- rbind(datatran_anos,tratado_temp)
# }
}
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
# df_temp1 <- read_csv2(enderecos[5], locale = locale(encoding = "latin1")) |> datatran_extract()
# df_temp1
if("datatran_anos" |> exists()){
rm("datatran_anos")
}
for(i in enderecos){
df_temp <- read.csv2(enderecos[i], locale = locale(encoding = "latin1"))
tratado_temp <- df_temp |> datatran_extract()
# if(exists("datatran_anos" == FALSE)){
#   datatran_anos <- tratado_temp
# }
# else{
#   datatran_anos <- rbind(datatran_anos,tratado_temp)
# }
}
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
# df_temp1 <- read_csv2(enderecos[5], locale = locale(encoding = "latin1")) |> datatran_extract()
# df_temp1
if("datatran_anos" |> exists()){
rm("datatran_anos")
}
for(i in enderecos){
df_temp <- read_csv2(enderecos[i], locale = locale(encoding = "latin1"))
tratado_temp <- df_temp |> datatran_extract()
if(exists("datatran_anos" == FALSE)){
datatran_anos <- tratado_temp
}
else{
datatran_anos <- rbind(datatran_anos,tratado_temp)
}
}
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
# df_temp1 <- read_csv2(enderecos[5], locale = locale(encoding = "latin1")) |> datatran_extract()
# df_temp1
if("datatran_anos" |> exists()){
rm("datatran_anos")
}
for(i in enderecos){
df_temp <- read_csv2(enderecos[i], locale = locale(encoding = "latin1"))
tratado_temp <- df_temp |> datatran_extract()
if(exists("datatran_anos") == FALSE){
datatran_anos <- tratado_temp
}
else{
datatran_anos <- rbind(datatran_anos,tratado_temp)
}
}
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
# df_temp1 <- read_csv2(enderecos[5], locale = locale(encoding = "latin1")) |> datatran_extract()
# df_temp1
if("datatran_anos" |> exists()){
rm("datatran_anos")
}
for(i in enderecos){
df_temp <- read_csv2(enderecos[i], locale = locale(encoding = "latin1"))
tratado_temp <- df_temp |> datatran_extract()
}
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
# df_temp1 <- read_csv2(enderecos[5], locale = locale(encoding = "latin1")) |> datatran_extract()
# df_temp1
if(exists("datatran_anos")){
rm("datatran_anos")
}
for(i in enderecos){
df_temp <- read_csv2(enderecos[i], locale = locale(encoding = "latin1"))
tratado_temp <- df_temp |> datatran_extract()
}
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
# df_temp1 <- read_csv2(enderecos[5], locale = locale(encoding = "latin1")) |> datatran_extract()
# df_temp1
for(i in enderecos){
df_temp <- read_csv2(enderecos[i], locale = locale(encoding = "latin1"))
tratado_temp <- df_temp |> datatran_extract()
}
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[5], locale = locale(encoding = "latin1")) |> datatran_extract()
df_temp1
# for(i in enderecos){
#   df_temp <- read_csv2(enderecos[i], locale = locale(encoding = "latin1"))
#   tratado_temp <- df_temp |> datatran_extract()
# }
datatran_anos
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[5], locale = locale(encoding = "latin1")) |> datatran_extract()
df_temp1
# for(i in enderecos){
#   df_temp <- read_csv2(enderecos[i], locale = locale(encoding = "latin1"))
#   tratado_temp <- df_temp |> datatran_extract()
# }
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[5], locale = locale(encoding = "latin1")) |> datatran_extract()
for(i in enderecos){
df_temp <- read_csv2(enderecos[i], locale = locale(encoding = "latin1")) |> datatran_extract()
}
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[k], locale = locale(encoding = "latin1")) |> datatran_extract()
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[1], locale = locale(encoding = "latin1")) |> datatran_extract()
for(i in enderecos){
df_temp <- read_csv2(enderecos[i], locale = locale(encoding = "latin1")) |> datatran_extract()
}
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[1], locale = locale(encoding = "latin1")) |> datatran_extract()
for(i in enderecos){
# df_temp <- read_csv2(i, locale = locale(encoding = "latin1")) |> datatran_extract()
print(i)
}
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[1], locale = locale(encoding = "latin1")) |> datatran_extract()
for(i in enderecos){
df_temp <- read_csv2(i, locale = locale(encoding = "latin1")) |> datatran_extract()
}
View(df_temp)
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[1], locale = locale(encoding = "latin1")) |> datatran_extract()
if("datatran_anos" |>  exists()){
rm("datatran_anos")
}
for(i in enderecos){
# df_temp <- read_csv2(i, locale = locale(encoding = "latin1")) |> datatran_extract()
}
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[1], locale = locale(encoding = "latin1")) |> datatran_extract()
if("datatran_anos" |>  exists()){
rm("datatran_anos")
}
for(i in enderecos){
# df_temp <- read_csv2(i, locale = locale(encoding = "latin1")) |> datatran_extract()
print(i)
}
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[1], locale = locale(encoding = "latin1")) |> datatran_extract()
if("datatran_anos" |>  exists()){
rm("datatran_anos")
}
for(i in enderecos){
# df_temp <- read_csv2(i, locale = locale(encoding = "latin1")) |> datatran_extract()
if(exists("datatran_anos")){
datatran_anos <- rbind(datatran_anos, df_temp)
}
else{
datatran_anos <- df_temp
}
}
datatran_anos
View(datatran_anos)
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
df_temp1 <- read_csv2(enderecos[1], locale = locale(encoding = "latin1")) |> datatran_extract()
if("datatran_anos" |>  exists()){
rm("datatran_anos")
}
for(i in enderecos){
df_temp <- read_csv2(i, locale = locale(encoding = "latin1")) |> datatran_extract()
if(exists("datatran_anos")){
datatran_anos <- rbind(datatran_anos, df_temp)
}
else{
datatran_anos <- df_temp
}
}
datatran_anos
View(acidentes2007)
View(datatran_anos)
View(datatran_anos)
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
# df_temp1 <- read_csv2(enderecos[1], locale = locale(encoding = "latin1")) |> datatran_extract()
if("datatran_anos" |>  exists()){
rm("datatran_anos")
}
for(i in enderecos){
df_temp <- read_csv2(i, locale = locale(encoding = "latin1")) |> datatran_extract()
if(exists("datatran_anos")){
datatran_anos <- bind_rows(datatran_anos, df_temp)
}
else{
datatran_anos <- df_temp
}
}
datatran_anos
datatran2007 <- read_csv2("datatran/datatran2007/datatran2007.csv", locale = locale(encoding = "latin1"))
acidentes2007 <- datatran2007 |>
select (
data_inversa,
mortos,
feridos,
classificacao_acidente
) |>
mutate(
ano = as.numeric(str_sub(data_inversa,-4,-1)),
classificacao_acidente = case_when(
classificacao_acidente %in% c("(null)","Ignorado") & mortos > 0 ~ "Com Vítimas Fatais",
classificacao_acidente %in% c("(null)","Ignorado") & mortos == 0 & feridos > 0 ~ "Com Vítimas Feridas",
classificacao_acidente %in% c("(null)","Ignorado") & mortos == 0 & feridos == 0 ~ "Sem Vítimas",
TRUE ~ classificacao_acidente
)
)
mortes2007 <- acidentes2007 |>
group_by(ano) |>
summarise(
qnt_acidentes = n(),
qnt_acidentes_fatais = sum(classificacao_acidente == "Com Vítimas Fatais"),
qnt_feridos = sum(feridos),
qnt_mortos = sum(mortos)
)
#criação da função
datatran_extract <- function(df) {
acidentes <- df |>
select (
data_inversa,
mortos,
feridos,
classificacao_acidente
) |>
mutate(
ano = case_when(
is.character(data_inversa) ~ year(dmy(data_inversa)),
!is.character(data_inversa) ~ year(data_inversa)
),
classificacao_acidente = case_when(
classificacao_acidente %in% c("(null)","Ignorado",NA) & mortos > 0 ~ "Com Vítimas Fatais",
classificacao_acidente %in% c("(null)","Ignorado",NA) & mortos == 0 & feridos > 0 ~ "Com Vítimas Feridas",
classificacao_acidente %in% c("(null)","Ignorado",NA) & mortos == 0 & feridos == 0 ~ "Sem Vítimas",
TRUE ~ classificacao_acidente
)
)
mortes <- acidentes |>
group_by(ano) |>
summarise(
qnt_acidentes = n(),
qnt_acidentes_fatais = sum(classificacao_acidente == "Com Vítimas Fatais"),
qnt_feridos = sum(feridos),
qnt_mortos = sum(mortos)
)
}
#testando a função
testes <- datatran_extract(datatran2007)
#criação da função
datatran_extract <- function(df) {
acidentes <- df |>
select (
data_inversa,
mortos,
feridos,
classificacao_acidente
) |>
mutate(
ano = case_when(
is.character(data_inversa) ~ year(dmy(data_inversa)),
!is.character(data_inversa) ~ year(data_inversa)
),
classificacao_acidente = case_when(
classificacao_acidente %in% c("(null)","Ignorado",NA) & mortos > 0 ~ "Com Vítimas Fatais",
classificacao_acidente %in% c("(null)","Ignorado",NA) & mortos == 0 & feridos > 0 ~ "Com Vítimas Feridas",
classificacao_acidente %in% c("(null)","Ignorado",NA) & mortos == 0 & feridos == 0 ~ "Sem Vítimas",
TRUE ~ classificacao_acidente
)
)
mortes <- acidentes |>
group_by(ano) |>
summarise(
qnt_acidentes = n(),
qnt_acidentes_fatais = sum(classificacao_acidente == "Com Vítimas Fatais"),
qnt_feridos = sum(feridos),
qnt_mortos = sum(mortos)
)
}
#testando a função
testes <- datatran_extract(datatran2007)
library(tidyverse)
library(microdatasus)
datatran2007 <- read_csv2("datatran/datatran2007/datatran2007.csv", locale = locale(encoding = "latin1"))
view(datatran2007)
acidentes2007 <- datatran2007 |>
select (
data_inversa,
mortos,
feridos,
classificacao_acidente
) |>
mutate(
ano = as.numeric(str_sub(data_inversa,-4,-1)),
classificacao_acidente = case_when(
classificacao_acidente %in% c("(null)","Ignorado") & mortos > 0 ~ "Com Vítimas Fatais",
classificacao_acidente %in% c("(null)","Ignorado") & mortos == 0 & feridos > 0 ~ "Com Vítimas Feridas",
classificacao_acidente %in% c("(null)","Ignorado") & mortos == 0 & feridos == 0 ~ "Sem Vítimas",
TRUE ~ classificacao_acidente
)
)
acidentes2007 |>
select(
classificacao_acidente
) |>
unique()
mortes2007 <- acidentes2007 |>
group_by(ano) |>
summarise(
qnt_acidentes = n(),
qnt_acidentes_fatais = sum(classificacao_acidente == "Com Vítimas Fatais"),
qnt_feridos = sum(feridos),
qnt_mortos = sum(mortos)
)
mortes2007
#criação da função
datatran_extract <- function(df) {
acidentes <- df |>
select (
data_inversa,
mortos,
feridos,
classificacao_acidente
) |>
mutate(
ano = case_when(
is.character(data_inversa) ~ year(dmy(data_inversa)),
!is.character(data_inversa) ~ year(data_inversa)
),
classificacao_acidente = case_when(
classificacao_acidente %in% c("(null)","Ignorado",NA) & mortos > 0 ~ "Com Vítimas Fatais",
classificacao_acidente %in% c("(null)","Ignorado",NA) & mortos == 0 & feridos > 0 ~ "Com Vítimas Feridas",
classificacao_acidente %in% c("(null)","Ignorado",NA) & mortos == 0 & feridos == 0 ~ "Sem Vítimas",
TRUE ~ classificacao_acidente
)
)
mortes <- acidentes |>
group_by(ano) |>
summarise(
qnt_acidentes = n(),
qnt_acidentes_fatais = sum(classificacao_acidente == "Com Vítimas Fatais"),
qnt_feridos = sum(feridos),
qnt_mortos = sum(mortos)
)
}
#testando a função
testes <- datatran_extract(datatran2007)
testes
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
# df_temp1 <- read_csv2(enderecos[1], locale = locale(encoding = "latin1")) |> datatran_extract()
if("datatran_anos" |>  exists()){
rm("datatran_anos")
}
for(i in enderecos){
df_temp <- read_csv2(i, locale = locale(encoding = "latin1")) |> datatran_extract()
if(exists("datatran_anos")){
datatran_anos <- bind_rows(datatran_anos, df_temp)
}
else{
datatran_anos <- df_temp
}
}
datatran_anos
#criação de loop para a importação de todos os anos
k <- seq(2007,2021,1)
enderecos <- print(paste("datatran/datatran",k,"/datatran",k,".csv",sep = ""))
# df_temp1 <- read_csv2(enderecos[1], locale = locale(encoding = "latin1")) |> datatran_extract()
if("datatran_anos" |>  exists()){
rm("datatran_anos")
}
for(i in enderecos){
df_temp <- read_csv2(i, locale = locale(encoding = "latin1")) |> datatran_extract()
if(exists("datatran_anos")){
datatran_anos <- bind_rows(datatran_anos, df_temp)
}
else{
datatran_anos <- df_temp
}
}
datatran_anos
library(tidyverse)
?knitr
library(tidyverse)
library(microdatasus)
library(obsplot)
library(knitr)
df_datasus <- fetch_datasus(
year_start = 1996,
year_end = 2021,
information_system = "SIM-DOEXT",
vars = c("DTOBITO","CAUSABAS")
)
library(tidyverse)
library(microdatasus)
library(obsplot)
library(knitr)
