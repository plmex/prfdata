error = function(e) {
if (str_sub(endereco,34,37) %in% c("2005","2004")) {
aux <- read_excel(endereco, sheet = 1, range = "B42:W43")
nomes <- aux |>
colnames() |>
toupper() |>
replace(
nomes %in% "UTILITARIO",
"UTILITÁRIO"
)
colnames(aux) <- nomes
return(aux)
}
else if (str_sub(endereco,34,37) == "2003") {
# precisou alterar o formato da planilha de .xls para .xlsx
# e excluir páginas vazias
# também é feito um subset da planilha para coletar só os totais
aux <- read_excel(endereco, sheet = 1, range = "B3:W33")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2002") {
aux <- read_excel(endereco, sheet = 1, range = "B7:W38")
colnames(aux) <- c(
"TOTAL", "AUTOMÓVEL", "BONDE", "CAMINHÃO", "CAMINHÃO TRATOR",
"CAMINHONETE", "CAMIONETA", "CHASSI PLATAF", "CICLOMOTOR", "MICROÔNIBUS",
"MOTOCICLETA", "MOTONETA", "ÔNIBUS", "QUADRICICLO", "REBOQUE",
"SEMIREBOQUE", "SIDECAR", "OUTROS", "TRATOR ESTEI", "TRATOR RODAS",
"TRICICLO","UTILITÁRIO")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2001") {
aux <- read_excel(endereco, sheet = 1, range = "B36:W38")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2000") {
aux <- read_excel(endereco, sheet = 1, range = "B36:W37")
return(aux[nrow(aux),])
}
else {
return(read_excel(endereco, sheet = 1, range = "B41:W42"))
}
}
)
return(frota)
}
num <- 5
exemplo <- enderecos_frota[num] |> import_frota2()
problem
problems
enderecos_frota[num]
enderecos_frota[num] |> import_frota2()
enderecos_frota[num] |> import_frota2()
import_frota2 <- function(endereco) {
frota <- tryCatch(
read_excel(endereco, sheet = 2, range = "B41:W42"),
error = function(e) {
if (str_sub(endereco,34,37) %in% c("2005","2004")) {
aux <- read_excel(endereco, sheet = 1, range = "B42:W43")
nomes <- aux |>
colnames() |>
toupper() |>
print(nomes)
return(aux)
}
else if (str_sub(endereco,34,37) == "2003") {
# precisou alterar o formato da planilha de .xls para .xlsx
# e excluir páginas vazias
# também é feito um subset da planilha para coletar só os totais
aux <- read_excel(endereco, sheet = 1, range = "B3:W33")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2002") {
aux <- read_excel(endereco, sheet = 1, range = "B7:W38")
colnames(aux) <- c(
"TOTAL", "AUTOMÓVEL", "BONDE", "CAMINHÃO", "CAMINHÃO TRATOR",
"CAMINHONETE", "CAMIONETA", "CHASSI PLATAF", "CICLOMOTOR", "MICROÔNIBUS",
"MOTOCICLETA", "MOTONETA", "ÔNIBUS", "QUADRICICLO", "REBOQUE",
"SEMIREBOQUE", "SIDECAR", "OUTROS", "TRATOR ESTEI", "TRATOR RODAS",
"TRICICLO","UTILITÁRIO")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2001") {
aux <- read_excel(endereco, sheet = 1, range = "B36:W38")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2000") {
aux <- read_excel(endereco, sheet = 1, range = "B36:W37")
return(aux[nrow(aux),])
}
else {
return(read_excel(endereco, sheet = 1, range = "B41:W42"))
}
}
)
return(frota)
}
num <- 5
exemplo <- enderecos_frota[num] |> import_frota2()
import_frota2 <- function(endereco) {
frota <- tryCatch(
read_excel(endereco, sheet = 2, range = "B41:W42"),
error = function(e) {
if (str_sub(endereco,34,37) %in% c("2005","2004")) {
aux <- read_excel(endereco, sheet = 1, range = "B42:W43")
nomes <- aux |>
colnames() |>
toupper()
print(nomes)
return(aux)
}
else if (str_sub(endereco,34,37) == "2003") {
# precisou alterar o formato da planilha de .xls para .xlsx
# e excluir páginas vazias
# também é feito um subset da planilha para coletar só os totais
aux <- read_excel(endereco, sheet = 1, range = "B3:W33")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2002") {
aux <- read_excel(endereco, sheet = 1, range = "B7:W38")
colnames(aux) <- c(
"TOTAL", "AUTOMÓVEL", "BONDE", "CAMINHÃO", "CAMINHÃO TRATOR",
"CAMINHONETE", "CAMIONETA", "CHASSI PLATAF", "CICLOMOTOR", "MICROÔNIBUS",
"MOTOCICLETA", "MOTONETA", "ÔNIBUS", "QUADRICICLO", "REBOQUE",
"SEMIREBOQUE", "SIDECAR", "OUTROS", "TRATOR ESTEI", "TRATOR RODAS",
"TRICICLO","UTILITÁRIO")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2001") {
aux <- read_excel(endereco, sheet = 1, range = "B36:W38")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2000") {
aux <- read_excel(endereco, sheet = 1, range = "B36:W37")
return(aux[nrow(aux),])
}
else {
return(read_excel(endereco, sheet = 1, range = "B41:W42"))
}
}
)
return(frota)
}
import_frota2(enderecos_frota[5])
import_frota2 <- function(endereco) {
frota <- tryCatch(
read_excel(endereco, sheet = 2, range = "B41:W42"),
error = function(e) {
if (str_sub(endereco,34,37) %in% c("2005","2004")) {
aux <- read_excel(endereco, sheet = 1, range = "B42:W43")
nomes <- aux |>
colnames() |>
toupper()
nomes <- replace(nomes, nomes %in% "UTILITARIO", "UTILITÁRIO")
return(aux)
}
else if (str_sub(endereco,34,37) == "2003") {
# precisou alterar o formato da planilha de .xls para .xlsx
# e excluir páginas vazias
# também é feito um subset da planilha para coletar só os totais
aux <- read_excel(endereco, sheet = 1, range = "B3:W33")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2002") {
aux <- read_excel(endereco, sheet = 1, range = "B7:W38")
colnames(aux) <- c(
"TOTAL", "AUTOMÓVEL", "BONDE", "CAMINHÃO", "CAMINHÃO TRATOR",
"CAMINHONETE", "CAMIONETA", "CHASSI PLATAF", "CICLOMOTOR", "MICROÔNIBUS",
"MOTOCICLETA", "MOTONETA", "ÔNIBUS", "QUADRICICLO", "REBOQUE",
"SEMIREBOQUE", "SIDECAR", "OUTROS", "TRATOR ESTEI", "TRATOR RODAS",
"TRICICLO","UTILITÁRIO")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2001") {
aux <- read_excel(endereco, sheet = 1, range = "B36:W38")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2000") {
aux <- read_excel(endereco, sheet = 1, range = "B36:W37")
return(aux[nrow(aux),])
}
else {
return(read_excel(endereco, sheet = 1, range = "B41:W42"))
}
}
)
return(frota)
}
import_frota2(enderecos_frota[5])
import_frota2 <- function(endereco) {
frota <- tryCatch(
read_excel(endereco, sheet = 2, range = "B41:W42"),
error = function(e) {
if (str_sub(endereco,34,37) %in% c("2005","2004")) {
aux <- read_excel(endereco, sheet = 1, range = "B42:W43")
nomes <- aux |>
colnames() |>
toupper()
nomes <- replace(nomes, nomes %in% "UTILITARIO", "UTILITÁRIO")
print(nomes)
return(aux)
}
else if (str_sub(endereco,34,37) == "2003") {
# precisou alterar o formato da planilha de .xls para .xlsx
# e excluir páginas vazias
# também é feito um subset da planilha para coletar só os totais
aux <- read_excel(endereco, sheet = 1, range = "B3:W33")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2002") {
aux <- read_excel(endereco, sheet = 1, range = "B7:W38")
colnames(aux) <- c(
"TOTAL", "AUTOMÓVEL", "BONDE", "CAMINHÃO", "CAMINHÃO TRATOR",
"CAMINHONETE", "CAMIONETA", "CHASSI PLATAF", "CICLOMOTOR", "MICROÔNIBUS",
"MOTOCICLETA", "MOTONETA", "ÔNIBUS", "QUADRICICLO", "REBOQUE",
"SEMIREBOQUE", "SIDECAR", "OUTROS", "TRATOR ESTEI", "TRATOR RODAS",
"TRICICLO","UTILITÁRIO")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2001") {
aux <- read_excel(endereco, sheet = 1, range = "B36:W38")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2000") {
aux <- read_excel(endereco, sheet = 1, range = "B36:W37")
return(aux[nrow(aux),])
}
else {
return(read_excel(endereco, sheet = 1, range = "B41:W42"))
}
}
)
return(frota)
}
import_frota2(enderecos_frota[5])
import_frota2 <- function(endereco) {
frota <- tryCatch(
read_excel(endereco, sheet = 2, range = "B41:W42"),
error = function(e) {
if (str_sub(endereco,34,37) %in% c("2005","2004")) {
aux <- read_excel(endereco, sheet = 1, range = "B42:W43")
nomes <- aux |>
colnames() |>
toupper()
nomes <- replace(nomes, nomes %in% "UTILITARIO", "UTILITÁRIO")
colnames(aux) <- nomes
return(aux)
}
else if (str_sub(endereco,34,37) == "2003") {
# precisou alterar o formato da planilha de .xls para .xlsx
# e excluir páginas vazias
# também é feito um subset da planilha para coletar só os totais
aux <- read_excel(endereco, sheet = 1, range = "B3:W33")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2002") {
aux <- read_excel(endereco, sheet = 1, range = "B7:W38")
colnames(aux) <- c(
"TOTAL", "AUTOMÓVEL", "BONDE", "CAMINHÃO", "CAMINHÃO TRATOR",
"CAMINHONETE", "CAMIONETA", "CHASSI PLATAF", "CICLOMOTOR", "MICROÔNIBUS",
"MOTOCICLETA", "MOTONETA", "ÔNIBUS", "QUADRICICLO", "REBOQUE",
"SEMIREBOQUE", "SIDECAR", "OUTROS", "TRATOR ESTEI", "TRATOR RODAS",
"TRICICLO","UTILITÁRIO")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2001") {
aux <- read_excel(endereco, sheet = 1, range = "B36:W38")
return(aux[nrow(aux),])
}
else if (str_sub(endereco,34,37) == "2000") {
aux <- read_excel(endereco, sheet = 1, range = "B36:W37")
return(aux[nrow(aux),])
}
else {
return(read_excel(endereco, sheet = 1, range = "B41:W42"))
}
}
)
return(frota)
}
num <- 5
exemplo <- enderecos_frota[num] |> import_frota2()
# frota_extract <- function(df){
#   result <- df |>
#     mutate(
#     automovel = AUTOMÓVEL + CAMINHONETE + CAMIONETA + UTILITÁRIO,
#     motocicleta = MOTOCICLETA + MOTONETA + CICLOMOTOR,
#     total = TOTAL
#   ) |>
#   select(
#     automovel,
#     motocicleta,
#     total
#   )
# }
frota_extract <- function(df){
# transforma dados em númerico caso estejam em formato de carácter
df_temp <- as.data.frame(lapply(df, as.numeric))
res <- df_temp |>
mutate(
automovel = AUTOMÓVEL + CAMINHONETE + CAMIONETA + UTILITÁRIO,
motocicleta = MOTOCICLETA + MOTONETA + CICLOMOTOR,
total = TOTAL
) |>
select(
automovel,
motocicleta,
total
)
return(res)
}
resultado <- frota_extract(exemplo)
View(resultado)
View(exemplo)
num <- 5
exemplo <- enderecos_frota[num] |> import_frota2()
# frota_extract <- function(df){
#   result <- df |>
#     mutate(
#     automovel = AUTOMÓVEL + CAMINHONETE + CAMIONETA + UTILITÁRIO,
#     motocicleta = MOTOCICLETA + MOTONETA + CICLOMOTOR,
#     total = TOTAL
#   ) |>
#   select(
#     automovel,
#     motocicleta,
#     total
#   )
# }
frota_extract <- function(df){
# transforma dados em númerico caso estejam em formato de carácter
df_temp <- as.data.frame(lapply(df, as.numeric))
res <- df_temp |>
mutate(
automovel = AUTOMÓVEL + CAMINHONETE + CAMIONETA + UTILITÁRIO,
motocicleta = MOTOCICLETA + MOTONETA + CICLOMOTOR,
total = TOTAL
) |>
select(
automovel,
motocicleta,
total
)
return(res)
}
resultado <- frota_extract(exemplo)
num <- 5
exemplo <- enderecos_frota[num] |> import_frota2()
# frota_extract <- function(df){
#   result <- df |>
#     mutate(
#     automovel = AUTOMÓVEL + CAMINHONETE + CAMIONETA + UTILITÁRIO,
#     motocicleta = MOTOCICLETA + MOTONETA + CICLOMOTOR,
#     total = TOTAL
#   ) |>
#   select(
#     automovel,
#     motocicleta,
#     total
#   )
# }
frota_extract <- function(df){
# transforma dados em númerico caso estejam em formato de carácter
df_temp <- as.data.frame(lapply(df, as.numeric))
res <- df_temp |>
mutate(
automovel = AUTOMÓVEL + CAMINHONETE + CAMIONETA + UTILITÁRIO,
motocicleta = MOTOCICLETA + MOTONETA + CICLOMOTOR,
total = TOTAL
) |>
select(
automovel,
motocicleta,
total
)
return(res)
}
resultado <- frota_extract(exemplo)
View(resultado)
if ("frota_anos" |> exists()) {
rm("frota_anos")
}
for(i in enderecos_frota) {
if ("frota_anos" |> exists()) {
frota_anos <- rbind(frota_anos, frota_extract(import_frota2(i)))
}
else {
frota_anos <- import_frota2(i) |> frota_extract()
}
}
View(frota_anos)
num <- 5
exemplo <- enderecos_frota[num] |> import_frota2()
# frota_extract <- function(df){
#   result <- df |>
#     mutate(
#     automovel = AUTOMÓVEL + CAMINHONETE + CAMIONETA + UTILITÁRIO,
#     motocicleta = MOTOCICLETA + MOTONETA + CICLOMOTOR,
#     total = TOTAL
#   ) |>
#   select(
#     automovel,
#     motocicleta,
#     total
#   )
# }
frota_extract <- function(df){
# transforma dados em númerico caso estejam em formato de carácter
df_temp <- as.data.frame(lapply(df, as.numeric))
res <- df_temp |>
mutate(
automovel = AUTOMÓVEL + CAMINHONETE + CAMIONETA + UTILITÁRIO,
motocicleta = MOTOCICLETA + MOTONETA + CICLOMOTOR,
total = TOTAL
) |>
select(
automovel,
motocicleta,
total
)
return(res)
}
resultado <- frota_extract(exemplo)
if ("frota_anos" |> exists()) {
rm("frota_anos")
}
for(i in enderecos_frota) {
if ("frota_anos" |> exists()) {
frota_anos <- rbind(frota_anos, frota_extract(import_frota2(i)))
}
else {
frota_anos <- import_frota2(i) |> frota_extract()
}
i |> str_sub(34,37) |> as.numeric() |> print()
}
if ("frota_anos" |> exists()) {
rm("frota_anos")
}
for(i in enderecos_frota) {
if ("frota_anos" |> exists()) {
frota_anos <- rbind(frota_anos, frota_extract(import_frota2(i)))
}
else {
frota_anos <- import_frota2(i) |> frota_extract()
anos <- i |> str_sub(34,37) |> as.numeric()
}
}
if ("frota_anos" |> exists()) {
rm("frota_anos")
}
for(i in enderecos_frota) {
if ("frota_anos" |> exists()) {
frota_anos <- rbind(frota_anos, frota_extract(import_frota2(i)))
}
else {
frota_anos <- import_frota2(i) |> frota_extract()
anos <- i |> str_sub(34,37) |> as.numeric()
}
}
if ("frota_anos" |> exists()) {
rm("frota_anos")
}
for(i in enderecos_frota) {
if ("frota_anos" |> exists()) {
frota_anos <- rbind(frota_anos, frota_extract(import_frota2(i)))
}
else {
frota_anos <- import_frota2(i) |> frota_extract()
anos <- i
}
}
if ("frota_anos" |> exists()) {
rm("frota_anos")
}
for(i in enderecos_frota) {
if ("frota_anos" |> exists()) {
frota_anos <- rbind(frota_anos, frota_extract(import_frota2(i)))
}
else {
frota_anos <- import_frota2(i) |> frota_extract()
anos <- i |> str_sub(34,37) |> as.numeric()
}
}
?append
if ("frota_anos" |> exists()) {
rm("frota_anos")
}
for(i in enderecos_frota) {
if ("frota_anos" |> exists()) {
frota_anos <- rbind(frota_anos, frota_extract(import_frota2(i)))
anos <- append(anos, i |> str_sub(34,37) |> as.numeric())
}
else {
frota_anos <- import_frota2(i) |> frota_extract()
anos <- i |> str_sub(34,37) |> as.numeric()
}
}
anos
if ("frota_anos" |> exists()) {
rm("frota_anos")
}
for(i in enderecos_frota) {
if ("frota_anos" |> exists()) {
frota_anos <- rbind(frota_anos, frota_extract(import_frota2(i)))
anos <- append(anos, i |> str_sub(34,37) |> as.numeric())
}
else {
frota_anos <- import_frota2(i) |> frota_extract()
anos <- i |> str_sub(34,37) |> as.numeric()
}
}
frota_anos$anos <- anos
View(frota_anos)
